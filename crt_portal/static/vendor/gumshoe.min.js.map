{"version":3,"file":"gumshoe.min.js","sources":["gumshoe.js"],"sourcesContent":["/*!\n * gumshoejs v5.1.2\n * A simple, framework-agnostic scrollspy script.\n * (c) 2019 Chris Ferdinandi\n * MIT License\n * http://github.com/cferdinandi/gumshoe\n */\n\n(function (root, factory) {\n\tif ( typeof define === 'function' && define.amd ) {\n\t\tdefine([], (function () {\n\t\t\treturn factory(root);\n\t\t}));\n\t} else if ( typeof exports === 'object' ) {\n\t\tmodule.exports = factory(root);\n\t} else {\n\t\troot.Gumshoe = factory(root);\n\t}\n})(typeof global !== 'undefined' ? global : typeof window !== 'undefined' ? window : this, (function (window) {\n\n\t'use strict';\n\n\t//\n\t// Defaults\n\t//\n\n\tvar defaults = {\n\n\t\t// Active classes\n\t\tnavClass: 'active',\n\t\tcontentClass: 'active',\n\n\t\t// Nested navigation\n\t\tnested: false,\n\t\tnestedClass: 'active',\n\n\t\t// Offset & reflow\n\t\toffset: 0,\n\t\treflow: false,\n\n\t\t// Event support\n\t\tevents: true\n\n\t};\n\n\n\t//\n\t// Methods\n\t//\n\n\t/**\n\t * Merge two or more objects together.\n\t * @param   {Object}   objects  The objects to merge together\n\t * @returns {Object}            Merged values of defaults and options\n\t */\n\tvar extend = function () {\n\t\tvar merged = {};\n\t\tArray.prototype.forEach.call(arguments, (function (obj) {\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (!obj.hasOwnProperty(key)) return;\n\t\t\t\tmerged[key] = obj[key];\n\t\t\t}\n\t\t}));\n\t\treturn merged;\n\t};\n\n\t/**\n\t * Emit a custom event\n\t * @param  {String} type   The event type\n\t * @param  {Node}   elem   The element to attach the event to\n\t * @param  {Object} detail Any details to pass along with the event\n\t */\n\tvar emitEvent = function (type, elem, detail) {\n\n\t\t// Make sure events are enabled\n\t\tif (!detail.settings.events) return;\n\n\t\t// Create a new event\n\t\tvar event = new CustomEvent(type, {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t\tdetail: detail\n\t\t});\n\n\t\t// Dispatch the event\n\t\telem.dispatchEvent(event);\n\n\t};\n\n\t/**\n\t * Get an element's distance from the top of the Document.\n\t * @param  {Node} elem The element\n\t * @return {Number}    Distance from the top in pixels\n\t */\n\tvar getOffsetTop = function (elem) {\n\t\tvar location = 0;\n\t\tif (elem.offsetParent) {\n\t\t\twhile (elem) {\n\t\t\t\tlocation += elem.offsetTop;\n\t\t\t\telem = elem.offsetParent;\n\t\t\t}\n\t\t}\n\t\treturn location >= 0 ? location : 0;\n\t};\n\n\t/**\n\t * Sort content from first to last in the DOM\n\t * @param  {Array} contents The content areas\n\t */\n\tvar sortContents = function (contents) {\n\t\tif(contents) {\n\t\t\tcontents.sort((function (item1, item2) {\n\t\t\t\tvar offset1 = getOffsetTop(item1.content);\n\t\t\t\tvar offset2 = getOffsetTop(item2.content);\n\t\t\t\tif (offset1 < offset2) return -1;\n\t\t\t\treturn 1;\n\t\t\t}));\n\t\t}\n\t};\n\n\t/**\n\t * Get the offset to use for calculating position\n\t * @param  {Object} settings The settings for this instantiation\n\t * @return {Float}           The number of pixels to offset the calculations\n\t */\n\tvar getOffset = function (settings) {\n\n\t\t// if the offset is a function run it\n\t\tif (typeof settings.offset === 'function') {\n\t\t\treturn parseFloat(settings.offset());\n\t\t}\n\n\t\t// Otherwise, return it as-is\n\t\treturn parseFloat(settings.offset);\n\n\t};\n\n\t/**\n\t * Get the document element's height\n\t * @private\n\t * @returns {Number}\n\t */\n\tvar getDocumentHeight = function () {\n\t\treturn Math.max(\n\t\t\tdocument.body.scrollHeight, document.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight, document.documentElement.offsetHeight,\n\t\t\tdocument.body.clientHeight, document.documentElement.clientHeight\n\t\t);\n\t};\n\n\t/**\n\t * Determine if an element is in view\n\t * @param  {Node}    elem     The element\n\t * @param  {Object}  settings The settings for this instantiation\n\t * @param  {Boolean} bottom   If true, check if element is above bottom of viewport instead\n\t * @return {Boolean}          Returns true if element is in the viewport\n\t */\n\tvar isInView = function (elem, settings, bottom) {\n\t\tvar bounds = elem.getBoundingClientRect();\n\t\tvar offset = getOffset(settings);\n\t\tif (bottom) {\n\t\t\treturn parseInt(bounds.bottom, 10) < (window.innerHeight || document.documentElement.clientHeight);\n\t\t}\n\t\treturn parseInt(bounds.top, 10) <= offset;\n\t};\n\n\t/**\n\t * Check if at the bottom of the viewport\n\t * @return {Boolean} If true, page is at the bottom of the viewport\n\t */\n\tvar isAtBottom = function () {\n\t\tif (window.innerHeight + window.pageYOffset >= getDocumentHeight()) return true;\n\t\treturn false;\n\t};\n\n\t/**\n\t * Check if the last item should be used (even if not at the top of the page)\n\t * @param  {Object} item     The last item\n\t * @param  {Object} settings The settings for this instantiation\n\t * @return {Boolean}         If true, use the last item\n\t */\n\tvar useLastItem = function (item, settings) {\n\t\tif (isAtBottom() && isInView(item.content, settings, true)) return true;\n\t\treturn false;\n\t};\n\n\t/**\n\t * Get the active content\n\t * @param  {Array}  contents The content areas\n\t * @param  {Object} settings The settings for this instantiation\n\t * @return {Object}          The content area and matching navigation link\n\t */\n\tvar getActive = function (contents, settings) {\n\t\tvar last = contents[contents.length-1];\n\t\tif (useLastItem(last, settings)) return last;\n\t\tfor (var i = contents.length - 1; i >= 0; i--) {\n\t\t\tif (isInView(contents[i].content, settings)) return contents[i];\n\t\t}\n\t};\n\n\t/**\n\t * Deactivate parent navs in a nested navigation\n\t * @param  {Node}   nav      The starting navigation element\n\t * @param  {Object} settings The settings for this instantiation\n\t */\n\tvar deactivateNested = function (nav, settings) {\n\n\t\t// If nesting isn't activated, bail\n\t\tif (!settings.nested || !nav.parentNode) return;\n\n\t\t// Get the parent navigation\n\t\tvar li = nav.parentNode.closest('li');\n\t\tif (!li) return;\n\n\t\t// Remove the active class\n\t\tli.classList.remove(settings.nestedClass);\n\n\t\t// Apply recursively to any parent navigation elements\n\t\tdeactivateNested(li, settings);\n\n\t};\n\n\t/**\n\t * Deactivate a nav and content area\n\t * @param  {Object} items    The nav item and content to deactivate\n\t * @param  {Object} settings The settings for this instantiation\n\t */\n\tvar deactivate = function (items, settings) {\n\n\t\t// Make sure there are items to deactivate\n\t\tif (!items) return;\n\n\t\t// Get the parent list item\n\t\tvar li = items.nav.closest('li');\n\t\tif (!li) return;\n\n\t\t// Remove the active class from the nav and content\n\t\tli.classList.remove(settings.navClass);\n\t\titems.content.classList.remove(settings.contentClass);\n\n\t\t// Deactivate any parent navs in a nested navigation\n\t\tdeactivateNested(li, settings);\n\n\t\t// Emit a custom event\n\t\temitEvent('gumshoeDeactivate', li, {\n\t\t\tlink: items.nav,\n\t\t\tcontent: items.content,\n\t\t\tsettings: settings\n\t\t});\n\n\t};\n\n\n\t/**\n\t * Activate parent navs in a nested navigation\n\t * @param  {Node}   nav      The starting navigation element\n\t * @param  {Object} settings The settings for this instantiation\n\t */\n\tvar activateNested = function (nav, settings) {\n\n\t\t// If nesting isn't activated, bail\n\t\tif (!settings.nested) return;\n\n\t\t// Get the parent navigation\n\t\tvar li = nav.parentNode.closest('li');\n\t\tif (!li) return;\n\n\t\t// Add the active class\n\t\tli.classList.add(settings.nestedClass);\n\n\t\t// Apply recursively to any parent navigation elements\n\t\tactivateNested(li, settings);\n\n\t};\n\n\t/**\n\t * Activate a nav and content area\n\t * @param  {Object} items    The nav item and content to activate\n\t * @param  {Object} settings The settings for this instantiation\n\t */\n\tvar activate = function (items, settings) {\n\n\t\t// Make sure there are items to activate\n\t\tif (!items) return;\n\n\t\t// Get the parent list item\n\t\tvar li = items.nav.closest('li');\n\t\tif (!li) return;\n\n\t\t// Add the active class to the nav and content\n\t\tli.classList.add(settings.navClass);\n\t\titems.content.classList.add(settings.contentClass);\n\n\t\t// Activate any parent navs in a nested navigation\n\t\tactivateNested(li, settings);\n\n\t\t// Emit a custom event\n\t\temitEvent('gumshoeActivate', li, {\n\t\t\tlink: items.nav,\n\t\t\tcontent: items.content,\n\t\t\tsettings: settings\n\t\t});\n\n\t};\n\n\t/**\n\t * Create the Constructor object\n\t * @param {String} selector The selector to use for navigation items\n\t * @param {Object} options  User options and settings\n\t */\n\tvar Constructor = function (selector, options) {\n\n\t\t//\n\t\t// Variables\n\t\t//\n\n\t\tvar publicAPIs = {};\n\t\tvar navItems, contents, current, timeout, settings;\n\n\n\t\t//\n\t\t// Methods\n\t\t//\n\n\t\t/**\n\t\t * Set variables from DOM elements\n\t\t */\n\t\tpublicAPIs.setup = function () {\n\n\t\t\t// Get all nav items\n\t\t\tnavItems = document.querySelectorAll(selector);\n\n\t\t\t// Create contents array\n\t\t\tcontents = [];\n\n\t\t\t// Loop through each item, get it's matching content, and push to the array\n\t\t\tArray.prototype.forEach.call(navItems, (function (item) {\n\n\t\t\t\t// Get the content for the nav item\n\t\t\t\tvar content = document.getElementById(decodeURIComponent(item.hash.substr(1)));\n\t\t\t\tif (!content) return;\n\n\t\t\t\t// Push to the contents array\n\t\t\t\tcontents.push({\n\t\t\t\t\tnav: item,\n\t\t\t\t\tcontent: content\n\t\t\t\t});\n\n\t\t\t}));\n\n\t\t\t// Sort contents by the order they appear in the DOM\n\t\t\tsortContents(contents);\n\n\t\t};\n\n\t\t/**\n\t\t * Detect which content is currently active\n\t\t */\n\t\tpublicAPIs.detect = function () {\n\n\t\t\t// Get the active content\n\t\t\tvar active = getActive(contents, settings);\n\n\t\t\t// if there's no active content, deactivate and bail\n\t\t\tif (!active) {\n\t\t\t\tif (current) {\n\t\t\t\t\tdeactivate(current, settings);\n\t\t\t\t\tcurrent = null;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If the active content is the one currently active, do nothing\n\t\t\tif (current && active.content === current.content) return;\n\n\t\t\t// Deactivate the current content and activate the new content\n\t\t\tdeactivate(current, settings);\n\t\t\tactivate(active, settings);\n\n\t\t\t// Update the currently active content\n\t\t\tcurrent = active;\n\n\t\t};\n\n\t\t/**\n\t\t * Detect the active content on scroll\n\t\t * Debounced for performance\n\t\t */\n\t\tvar scrollHandler = function (event) {\n\n\t\t\t// If there's a timer, cancel it\n\t\t\tif (timeout) {\n\t\t\t\twindow.cancelAnimationFrame(timeout);\n\t\t\t}\n\n\t\t\t// Setup debounce callback\n\t\t\ttimeout = window.requestAnimationFrame(publicAPIs.detect);\n\n\t\t};\n\n\t\t/**\n\t\t * Update content sorting on resize\n\t\t * Debounced for performance\n\t\t */\n\t\tvar resizeHandler = function (event) {\n\n\t\t\t// If there's a timer, cancel it\n\t\t\tif (timeout) {\n\t\t\t\twindow.cancelAnimationFrame(timeout);\n\t\t\t}\n\n\t\t\t// Setup debounce callback\n\t\t\ttimeout = window.requestAnimationFrame((function () {\n\t\t\t\tsortContents(contents);\n\t\t\t\tpublicAPIs.detect();\n\t\t\t}));\n\n\t\t};\n\n\t\t/**\n\t\t * Destroy the current instantiation\n\t\t */\n\t\tpublicAPIs.destroy = function () {\n\n\t\t\t// Undo DOM changes\n\t\t\tif (current) {\n\t\t\t\tdeactivate(current, settings);\n\t\t\t}\n\n\t\t\t// Remove event listeners\n\t\t\twindow.removeEventListener('scroll', scrollHandler, false);\n\t\t\tif (settings.reflow) {\n\t\t\t\twindow.removeEventListener('resize', resizeHandler, false);\n\t\t\t}\n\n\t\t\t// Reset variables\n\t\t\tcontents = null;\n\t\t\tnavItems = null;\n\t\t\tcurrent = null;\n\t\t\ttimeout = null;\n\t\t\tsettings = null;\n\n\t\t};\n\n\t\t/**\n\t\t * Initialize the current instantiation\n\t\t */\n\t\tvar init = function () {\n\n\t\t\t// Merge user options into defaults\n\t\t\tsettings = extend(defaults, options || {});\n\n\t\t\t// Setup variables based on the current DOM\n\t\t\tpublicAPIs.setup();\n\n\t\t\t// Find the currently active content\n\t\t\tpublicAPIs.detect();\n\n\t\t\t// Setup event listeners\n\t\t\twindow.addEventListener('scroll', scrollHandler, false);\n\t\t\tif (settings.reflow) {\n\t\t\t\twindow.addEventListener('resize', resizeHandler, false);\n\t\t\t}\n\n\t\t};\n\n\n\t\t//\n\t\t// Initialize and return the public APIs\n\t\t//\n\n\t\tinit();\n\t\treturn publicAPIs;\n\n\t};\n\n\n\t//\n\t// Return the Constructor\n\t//\n\n\treturn Constructor;\n\n}));\n"],"names":["root","factory","define","amd","exports","module","Gumshoe","global","window","this","sortContents","contents","sort","item1","item2","getOffsetTop","content","isAtBottom","innerHeight","pageYOffset","Math","max","document","body","scrollHeight","documentElement","offsetHeight","clientHeight","deactivate","items","settings","li","nav","closest","classList","remove","navClass","contentClass","deactivateNested","emitEvent","link","defaults","nested","nestedClass","offset","reflow","events","type","elem","detail","event","CustomEvent","bubbles","cancelable","dispatchEvent","location","offsetParent","offsetTop","isInView","bottom","bounds","getBoundingClientRect","parseFloat","parseInt","top","useLastItem","item","parentNode","activateNested","add","selector","options","navItems","current","timeout","publicAPIs","setup","querySelectorAll","Array","prototype","forEach","call","getElementById","decodeURIComponent","hash","substr","push","detect","active","last","length","i","getActive","scrollHandler","cancelAnimationFrame","requestAnimationFrame","resizeHandler","destroy","removeEventListener","merged","arguments","obj","key","hasOwnProperty","extend","addEventListener"],"mappings":"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"}